<!DOCTYPE html>
<html>
<head>
    <title>Graph::Easy Test</title>
    <script src="webperl/webperl.js"></script>
</head>
<body>
    <h1>Graph::Easy WebPerl Test</h1>
    <div id="output"></div>

    <script>
    // Add output textarea
    window.addEventListener("load", function () {
        document.getElementById('output').appendChild(Perl.makeOutputTextarea());
    });

    // Listen for when Perl becomes ready
    Perl.addStateChangeListener(function(from, to) {
        console.log('Perl state: ' + from + ' -> ' + to);

        if (to === 'Ready') {
            console.log('Perl is ready! FS available:', typeof FS);
            console.log('Attempting to create directory...');

            try {
                FS.mkdir('/test');
                FS.writeFile('/test/hello.txt', 'Hello from FS!');
                console.log('Successfully created /test/hello.txt');

                // Try to read it back
                var content = FS.readFile('/test/hello.txt', {encoding: 'utf8'});
                console.log('Read back:', content);
            } catch(e) {
                console.error('FS test failed:', e);
            }
        }
    });
    </script>

    <script type="text/perl">
    print "Hello from Perl!\n";
    print "Perl version: $]\n";
    </script>
</body>
</html>
